---
- hosts: localhost
  connection: local
  become: true

  tasks:

  - name:
    ansible.builtin.command: "{{ item }}"
    with_items:
      - pacman-key --recv-key FBA220DFC880C036 --keyserver keyserver.ubuntu.com
      - pacman-key --lsign-key FBA220DFC880C036
      - pacman -U 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst' 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst'

  - name: changepacmanconf
    copy: src={{ item.src }} dest={{ item.dest }}
    with_items:
       - { src: '/gits/ansible/pacman.conf', dest: '/etc/pacman.conf' }
  
  - name: update
    pacman:
      update_cache: yes
      upgrade: yes

  - name: install packages
    package:
      name:
        - dkms
        - linux-zen
        - noto-fonts
        - pipewire
        - pipewire-pulse
        - pipewire-jack
        - pipewire-alsa
        - wireplumber
        - plasma-meta
        - xorg-server
        - sddm
        - zsh
        - zsh-autosuggestions
        - zsh-completions
        - zsh-syntax-highlighting
        - zsh-theme-powerlevel10k
        - lutris
        - steam
        - element
        - openvpn
        - nvidia-dkms
        - nvidia-utils
        - bluez
        - clamav
        - kcm-wacomtablet
        - flameshot
        - flatpak
        - helvum
        - amd-ucode
        - networkmanager
        - neofetch
        - os-prober
        - p7zip
        - ufw
        - vlc
        - efibootmgr
        - xournalpp
        - firefox
        - packagekit-qt5
        - kalendar-git
        - yay      


  - name: flat packages
    community.general.flatpak:
      name:
        - com.spotify.Client
        - org.godotengine.Godot
        - com.mojang.Minecraft
        - org.gimp.GIMP
        - org.kde.kdenlive